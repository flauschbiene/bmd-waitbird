<!DOCTYPE html>
<html>
<head>
<title>Woopdiwoop</title>
<meta charset="UTF-8">
<style>
    
</style>
</head>

<body>

<script>

var table = "0123456789" +
    "abcdefghijklmnopqrstuvwxzy" +
    "ABCDEFGHIJKLMNOPQRSTUVWXZY" +
    "!@#$%^&*()_+-={}[]:\"|;'\\<>?,./~`";

function chr(ord) {
    if (ord < 0 || ord >= table.length) {
        return ' ';
    }
    return table.charAt(ord);
}

function ord(chr) {
    var ord = table.indexOf(chr);
    return (ord === -1) ? table.length : ord;
}

function encrypt(secret, message) {
    
    var text = [];
    var j = 0;

    for (var i = 0; i < message.length; i++) {
        var char = message.charAt(i);
        var c = ord(char);
        var s = ord(secret.charAt(j));

        text.push(c ^ s);

        j = (j + 1) % secret.length;
    }

    return text.join(",");
}

function decrypt(secret, message) {
    var codes = message.split(",");

    var text = [];
    var j = 0;

    for (var i = 0; i < codes.length; i++) {
        var c = parseInt(codes[i], 10);
        var s = ord(secret.charAt(j));

        text.push(chr(c ^ s));

        j = (j + 1) % secret.length;
    }

    return text.join("");
}

function doCrypt(cipher) {
    var $message = document.getElementById("message");
    var $secret = document.getElementById("secret");
    
    var message = $message.value;

    if (typeof cipher === "undefined") {
        cipher = /^[0-9]+(,[0-9]+)*$/.test(message) ? decrypt : encrypt;
    }

    $message.value = cipher($secret.value, message);
}

</script>

<input type="text" id="secret">

<textarea id="message"></textarea>

<button onclick="doCrypt()">crypt</button>
<!-- <button onclick="doCrypt(encrypt)">encrypt</button>
<button onclick="doCrypt(decrypt)">decrypt</button> -->

</body>
</html>
